/*! campi-moduli-italiani 2.1.0 */
"use strict";jQuery(document).ready(function(b){b("input[type=checkbox][id^='gcmi-']").prop("checked",!1),b("input[type=hidden][id^='gcmi-updated-']").each(function(e){"false"==b(this).val()&&(window.MySuffix=b(this).attr("id").substring("gcmi-updated-".length,b(this).attr("id").length),b("input[type=checkbox][id='gcmi-"+window.MySuffix+"']").prop("checked",!0))});const u=300;var c="";function i(){b("button[id^='gcmi-fb-delete-filter-']").attr("disabled","disabled"),b("button[id^='gcmi-fb-edit-filter-']").attr("disabled","disabled"),b("#gcmi-fb-addnew-filter").attr("disabled","disabled")}function n(){b("#gcmi-fb-tabs-2").empty(),b("#gcmi-fb-tabs-3").empty(),b("#gcmi-fb-tabs-4").empty(),b("#gcmi-fb-tabs-5").empty()}function o(){var e="<span>In attesa dei dati...</span>";b("#gcmi-fb-tabs-2").append(e),b("#gcmi-fb-tabs-3").append(e),b("#gcmi-fb-tabs-4").append(e),b("#gcmi-fb-tabs-5").append(e)}function a(){var e=b("#gcmi-fb-include-ceased").prop("checked");b.ajax({type:"post",dataType:"json",url:gcmi_fb_obj.ajax_url,data:{action:"gcmi_fb_requery_comuni",_ajax_nonce:gcmi_fb_obj.nonce,includi:e},success:function(e){n(),b("#gcmi-fb-tabs-2").append(e.regioni_html),b("#gcmi-fb-tabs-3").append(e.province_html),b("#gcmi-fb-tabs-4").append(e.comuni_html),b("#gcmi-fb-tabs-5").append(e.commit_buttons)}})}function m(e){var i=b("#gcmi-fb-include-ceased").prop("checked");b.ajax({type:"post",dataType:"json",url:gcmi_fb_obj.ajax_url,data:{action:"gcmi_fb_edit_filter",_ajax_nonce:gcmi_fb_obj.nonce,includi:i,filtername:e},success:function(e){n(),"true"===e.includi?b("input[type='checkbox'][id='gcmi-fb-include-ceased']").prop("checked",!0):b("input[type='checkbox'][id='gcmi-fb-include-ceased']").removeAttr("checked"),b("#gcmi-fb-tabs-2").append(e.regioni_html),b("#gcmi-fb-tabs-3").append(e.province_html),b("#gcmi-fb-tabs-4").append(e.comuni_html),b("#gcmi-fb-tabs-5").append(e.commit_buttons),b("#gcmi-fb-tabs-2 input[type=checkbox]:not(:checked)").not("[id^='fb-gcmi-chkall-']").each(function(){b(this).change()}),b("#gcmi-fb-tabs-3 input[type=checkbox]:not(:checked)").not("[id^='fb-gcmi-chkallpr-']").each(function(){b(this).change()}),b(".gcmi-fb-lettera-blocco").each(function(){b(this).find(":checkbox").not("[id^='fb-gcmi-chkallcom-']").first().change()})},error:function(e){_(e,"RetrieveFilter")}})}function g(){b.ajax({type:"post",dataType:"json",url:gcmi_fb_obj.ajax_url,data:{action:"gcmi_fb_get_filters",_ajax_nonce:gcmi_fb_obj.nonce},success:function(e){b("#gcmi-fb-filters-container").html(""),b("#gcmi-fb-filters-container").append(e.data.filters_html)}})}function r(){b("div[class^='gcmi-fb-lettera-blocco']").each(function(){var e=b(this);0===e.find("input[type=checkbox][id^='fb-gcmi-com-']:checked").length?e.hide():e.show()})}function l(e,i){var t=new jQuery.Deferred;return b("#gcmi-fb-dialog").html(e),b("#gcmi-fb-dialog").dialog({resizable:!1,height:240,modal:!0,title:i,buttons:{OK:function(){b(this).dialog("close"),t.resolve()},Cancel:function(){b(this).dialog("close"),t.reject()}}}),t.promise()}function f(e,i){var t=new jQuery.Deferred;return b("#gcmi-fb-dialog").html(e),b("#gcmi-fb-dialog").dialog({resizable:!1,height:240,modal:!0,title:i,buttons:{OK:function(){b(this).dialog("close"),t.resolve()}}}),t.promise()}function s(e,i,t,c=!1){if(t.length>u){var[a,r,n,l=!1]=[e,i,t,c];var f=function(i,t){var c=[];for(let e=0;e<i.length;e+=t){var n=i.slice(e,e+t);c.push(n)}return c}(n,u);let o=f.length;var s=0,p=n.length,n=f.map(async function(e,i){var t;return t=1e3,await new Promise(e=>setTimeout(e,t)),b.ajax({type:"post",dataType:"json",url:gcmi_fb_obj.ajax_url,tryCount:0,retryLimit:3,data:{action:"gcmi_fb_save_filter_slice",_ajax_nonce:gcmi_fb_obj.nonce,includi:a,filtername:r,codici:e,total:o,slice:i+1},success:function(e){s++},error:function(e){if(422==e.status)return this.tryCount++,this.tryCount<=this.retryLimit?void b.ajax(this):void _(e,"CreateFilter");422!=e.status&&_(e)}})});b.when(...n).then(()=>{var e,i,t,c,n;o===s&&([e,i,t,c,n=!1]=[a,r,o,p,l],b.ajax({type:"post",dataType:"json",url:gcmi_fb_obj.ajax_url,tryCount:0,retryLimit:3,data:{action:"gcmi_fb_create_filter_multi",_ajax_nonce:gcmi_fb_obj.nonce,includi:e,filtername:i,total:t,count:c},success:function(e){!1===n?(g(),b("#gcmi-fb-tabs").hide()):(m(i),h("#fb_gcmi_filter_name",function(){b.ajax({type:"post",dataType:"json",url:gcmi_fb_obj.ajax_url,data:{action:"gcmi_fb_delete_filter",_ajax_nonce:gcmi_fb_obj.nonce,filtername:i},error:function(e){console.log(e)}})}))},error:function(e){if(422==e.status)return this.tryCount++,this.tryCount<=this.retryLimit?void b.ajax(this):void _(e,!1===n?"CreateFilter":"TmpFilterFailed");422!=e.status&&_(e,!1===n?"CreateFilter":"TmpFilterFailed")}}))})}else o=i,d=c,b.ajax({type:"post",dataType:"json",url:gcmi_fb_obj.ajax_url,data:{action:"gcmi_fb_create_filter",_ajax_nonce:gcmi_fb_obj.nonce,includi:e,filtername:o,codici:t},success:function(e){!1===d?(g(),b("#gcmi-fb-tabs").hide()):(m(o),h("#fb_gcmi_filter_name",function(){b.ajax({type:"post",dataType:"json",url:gcmi_fb_obj.ajax_url,data:{action:"gcmi_fb_delete_filter",_ajax_nonce:gcmi_fb_obj.nonce,filtername:o},error:function(e){console.log(e)}})}))},error:function(e){_(e,!1===d?"CreateFilter":"TmpFilterFailed")}});var o,d}function h(e,i){b(e).length?i():setTimeout(function(){h(e,i)},100)}function _(e,i){let t="";var c,n='<span class="ui-icon ui-icon-notice" style="float:left; margin:12px 12px 0 0;"></span>';let o=n;switch(i){case"CreateFilter":t="Errore nella creazione del filtro";break;case"RetrieveFilter":t="Errore nel recupero dei dati";break;case"TmpFilterFailed":t="Errore nella creazione del filtro temporaneo";break;default:t="Ricevuto errore dal server"}if(e.responseJSON){c=e.responseJSON.data;for(let e=0;e<c.length;e++)o=o+"<p><b>Err: "+c[e].code+"</b></p><p><i>"+c[e].message+"</i></p><p></p>"}else o=n+"<p><b>Err: Errore non definito</b></p>";switch(i){case"CreateFilter":return void b.when(f(o,t)).then(void b("#fb_gcmi_filter_name").focus());case"TmpFilterFailed":return void b.when(f(o,t)).then(a())}}b("#gcmi-fb-tabs").hide(),b(document).on("click","#gcmi-fb-addnew-filter",function(){b("#gcmi-fb-tabs").show(),i(),n(),o(),b("input[type='checkbox'][id='gcmi-fb-include-ceased']").removeAttr("checked"),a()}),b(document).on("click","button[id^='gcmi-fb-edit-filter-']",function(){var e=b(this).attr("id").split("-").pop();c=e,b("#gcmi-fb-tabs").show(),i(),n(),o(),m(e),h("#fb_gcmi_filter_name",function(){b("#fb_gcmi_filter_name").val(c)})}),b(document).on("click","button[id^='gcmi-fb-delete-filter-']",function(){let e=b(this).attr("id").split("-").pop();var i='<span class="ui-icon ui-icon-alert" style="float:left; margin:12px 12px 20px 0;"></span><p>Vuoi davvero cancellare il filtro: <b>'+e+"</b>?</p>ATTENZIONE: Questa operazione non può controllare se il filtro è attualmente in uso nei tuoi moduli.";b.when(l(i,"Conferma eliminazione filtro")).then(function(){b.ajax({type:"post",dataType:"json",url:gcmi_fb_obj.ajax_url,data:{action:"gcmi_fb_delete_filter",_ajax_nonce:gcmi_fb_obj.nonce,filtername:e},success:function(e){g()},error:function(e){let i='<span class="ui-icon ui-icon-notice" style="float:left; margin:12px 12px 0 0;"></span>';var t=e.responseJSON.data;for(let e=0;e<t.length;e++)i=i+"<p><b>Err: "+t[e].code+"</b></p><p><i>"+t[e].message+"</i></p><p></p>";b.when(f(i,"Errore nella eliminazione del filtro")).then(function(){})}})})}),b(document).on("click","#gcmi-fb-button-cancel",function(){b.when(l('<span class="ui-icon ui-icon-alert" style="float:left; margin:12px 12px 20px 0;"></span>Vuoi annullare la creazione/modifica del filtro?',"Conferma annullamento operazione")).then(function(){b("#gcmi-fb-tabs").hide(),b("button[id^='gcmi-fb-delete-filter-']").removeAttr("disabled"),b("button[id^='gcmi-fb-edit-filter-']").removeAttr("disabled"),b("#gcmi-fb-addnew-filter").attr("disabled",!1)},function(){})}),b(document).on("click","#gcmi-fb-button-save",function(){event.preventDefault();var t=b("#gcmi-fb-tabs-4").find("input[type=checkbox]:checked").not("[id^='fb-gcmi-chkallcom-']").map(function(){return b(this).val()}).get();if(0===t.length)b.when(f('<span class="ui-icon ui-icon-notice" style="float:left; margin:12px 12px 20px 0;"></span>Non è stato selezionato nessun comune da includere nel filtro.',"Errore nel salvataggio")).then(function(){b("#ui-id-4").click()});else{let i=b("#fb_gcmi_filter_name").val();if(""===i)b.when(f('<span class="ui-icon ui-icon-notice" style="float:left; margin:12px 12px 20px 0;"></span>Non è stato indicato il nome del filtro.',"Errore nel salvataggio")).then(function(){b("#fb_gcmi_filter_name").focus()});else if(20<i.length)b.when(l('<span class="ui-icon ui-icon-notice" style="float:left; margin:12px 12px 20px 0;"></span>Non più di 20 caratteri ammessi per il nome del filtro.',"Errore nel salvataggio")).then(function(){b("#fb_gcmi_filter_name").val(i.substring(0,20)),b("#fb_gcmi_filter_name").focus()});else{let e=b("#gcmi-fb-include-ceased").prop("checked");var c=function(e){let i;{if("string"==typeof e||e instanceof String){if(0===e.length)return!1;i=e.trim();e=new RegExp(/[\x80-\xff]/g);return 0!==(i=(i=e.test(i)?function(i){var t={"ª":"a","º":"o","À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","Æ":"AE","Ç":"C","È":"E","É":"E","Ê":"E","Ë":"E","Ì":"I","Í":"I","Î":"I","Ï":"I","Ð":"D","Ñ":"N","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ù":"U","Ú":"U","Û":"U","Ü":"U","Ý":"Y","Þ":"TH","ß":"s","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","æ":"ae","ç":"c","è":"e","é":"e","ê":"e","ë":"e","ì":"i","í":"i","î":"i","ï":"i","ð":"d","ñ":"n","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","ù":"u","ú":"u","û":"u","ü":"u","ý":"y","þ":"th","ÿ":"y","Ø":"O","Ā":"A","ā":"a","Ă":"A","ă":"a","Ą":"A","ą":"a","Ć":"C","ć":"c","Ĉ":"C","ĉ":"c","Ċ":"C","ċ":"c","Č":"C","č":"c","Ď":"D","ď":"d","Đ":"D","đ":"d","Ē":"E","ē":"e","Ĕ":"E","ĕ":"e","Ė":"E","ė":"e","Ę":"E","ę":"e","Ě":"E","ě":"e","Ĝ":"G","ĝ":"g","Ğ":"G","ğ":"g","Ġ":"G","ġ":"g","Ģ":"G","ģ":"g","Ĥ":"H","ĥ":"h","Ħ":"H","ħ":"h","Ĩ":"I","ĩ":"i","Ī":"I","ī":"i","Ĭ":"I","ĭ":"i","Į":"I","į":"i","İ":"I","ı":"i","Ĳ":"IJ","ĳ":"ij","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","ĺ":"l","Ļ":"L","ļ":"l","Ľ":"L","ľ":"l","Ŀ":"L","ŀ":"l","Ł":"L","ł":"l","Ń":"N","ń":"n","Ņ":"N","ņ":"n","Ň":"N","ň":"n","ŉ":"n","Ŋ":"N","ŋ":"n","Ō":"O","ō":"o","Ŏ":"O","ŏ":"o","Ő":"O","ő":"o","Œ":"OE","œ":"oe","Ŕ":"R","ŕ":"r","Ŗ":"R","ŗ":"r","Ř":"R","ř":"r","Ś":"S","ś":"s","Ŝ":"S","ŝ":"s","Ş":"S","ş":"s","Š":"S","š":"s","Ţ":"T","ţ":"t","Ť":"T","ť":"t","Ŧ":"T","ŧ":"t","Ũ":"U","ũ":"u","Ū":"U","ū":"u","Ŭ":"U","ŭ":"u","Ů":"U","ů":"u","Ű":"U","ű":"u","Ų":"U","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","ź":"z","Ż":"Z","ż":"z","Ž":"Z","ž":"z","ſ":"s","Ə":"E","ǝ":"e","Ș":"S","ș":"s","Ț":"T","ț":"t","€":"E","£":"","Ơ":"O","ơ":"o","Ư":"U","ư":"u","Ầ":"A","ầ":"a","Ằ":"A","ằ":"a","Ề":"E","ề":"e","Ồ":"O","ồ":"o","Ờ":"O","ờ":"o","Ừ":"U","ừ":"u","Ỳ":"Y","ỳ":"y","Ả":"A","ả":"a","Ẩ":"A","ẩ":"a","Ẳ":"A","ẳ":"a","Ẻ":"E","ẻ":"e","Ể":"E","ể":"e","Ỉ":"I","ỉ":"i","Ỏ":"O","ỏ":"o","Ổ":"O","ổ":"o","Ở":"O","ở":"o","Ủ":"U","ủ":"u","Ử":"U","ử":"u","Ỷ":"Y","ỷ":"y","Ẫ":"A","ẫ":"a","Ẵ":"A","ẵ":"a","Ẽ":"E","ẽ":"e","Ễ":"E","ễ":"e","Ỗ":"O","ỗ":"o","Ỡ":"O","ỡ":"o","Ữ":"U","ữ":"u","Ỹ":"Y","ỹ":"y","Ấ":"A","ấ":"a","Ắ":"A","ắ":"a","Ế":"E","ế":"e","Ố":"O","ố":"o","Ớ":"O","ớ":"o","Ứ":"U","ứ":"u","Ạ":"A","ạ":"a","Ậ":"A","ậ":"a","Ặ":"A","ặ":"a","Ẹ":"E","ẹ":"e","Ệ":"E","ệ":"e","Ị":"I","ị":"i","Ọ":"O","ọ":"o","Ộ":"O","ộ":"o","Ợ":"O","ợ":"o","Ụ":"U","ụ":"u","Ự":"U","ự":"u","Ỵ":"Y","ỵ":"y","ɑ":"a","Ǖ":"U","ǖ":"u","Ǘ":"U","ǘ":"u","Ǎ":"A","ǎ":"a","Ǐ":"I","ǐ":"i","Ǒ":"O","ǒ":"o","Ǔ":"U","ǔ":"u","Ǚ":"U","ǚ":"u","Ǜ":"U","ǜ":"u"};var c;b.ajax({type:"post",dataType:"json",url:gcmi_fb_obj.ajax_url,async:!1,data:{action:"gcmi_fb_get_locale",_ajax_nonce:gcmi_fb_obj.nonce},success:function(e){c=e.locale},error:function(e){c="unknown"}}),c.startsWith("de")?(t["Ä"]="Ae",t["ä"]="ae",t["Ö"]="Oe",t["ö"]="oe",t["Ü"]="Ue",t["ü"]="ue",t["ß"]="ss"):"da_DK"===c?(t["Æ"]="Ae",t["æ"]="ae",t["Ø"]="Oe",t["ø"]="oe",t["Å"]="Aa",t["å"]="aa"):"ca"===c?t["l·l"]="ll":"sr_RS"!==c&&"bs_BA"!==c||(t["Đ"]="DJ",t["đ"]="dj");let n="";for(let e=0;e<i.length;e++)i.charAt(e)in t?n+=t[i.charAt(e)]:n+=i.charAt(e);return n}(i):i).toLowerCase().replace(/[^a-z0-9_\-]/g,"").replace(/-/g,"_").replace(/(_)\1+/g,"_").replace(/^_+/,"").replace(/_+$/,"")).length&&i}return!1}}(i).substring(0,20);if(!1===c)b.when(f('<span class="ui-icon ui-icon-notice" style="float:left; margin:12px 12px 20px 0;"></span>Non è stato indicato un nome valido per il filtro.',"Errore nel salvataggio")).then(function(){b("#fb_gcmi_filter_name").focus()});else if(i!==c)n='<span class="ui-icon ui-icon-notice" style="float:left; margin:12px 12px 20px 0;"></span>Il valore indicato per il nome del filtro:<b><i>'+i+"</i></b> non è utilizzabile.<br>Vuoi utilizzare: <b>"+c+"</b> ?",b.when(l(n,"Errore nel salvataggio")).then(function(){b("#fb_gcmi_filter_name").val(c)});else{var n=b(".gcmi-fb-filters-container").find("span.gcmi-fb-filters-name").map(function(){return b(this).text()}).get();let i=!1;n.forEach(function(e){c===e&&(i=!0)}),!0===i?b.when(l('<span class="ui-icon ui-icon-notice" style="float:left; margin:12px 12px 20px 0;"></span>Stai sovrascrivendo il filtro:<b><i>'+c+"</i></b>.<br>Vuoi continuare?","Sovrascrivi")).then(function(){s(e,c,t)}):s(e,c,t)}}}}),b("#gcmi-fb-tabs").tabs({active:0,collapsible:!0,heightStyle:"content",classes:{"ui-tabs":"ui-corner-none","ui-tabs-nav":"ui-corner-none","ui-tabs-tab":"ui-corner-none","ui-tabs-panel":"ui-corner-none"}}),b(document).on("change","input[type='checkbox'][id^='fb-gcmi-reg-']",function(){var e=b(this),i=b(this).attr("id").split("-").pop();!1===e.prop("checked")?(b("#gcmi-fb-regione-blocco-"+i).find('input[type=checkbox][id^="fb-gcmi-prov-"]:checked').removeAttr("checked"),b("#gcmi-fb-regione-blocco-"+i).find('input[type=checkbox][id^="fb-gcmi-prov-"]').trigger("change"),b("#gcmi-fb-regione-blocco-"+i).hide()):(b("#gcmi-fb-regione-blocco-"+i).find('input[type=checkbox][id^="fb-gcmi-prov-"]:not(:checked)').prop("checked",!0),b("#gcmi-fb-regione-blocco-"+i).find('input[type=checkbox][id^="fb-gcmi-prov-"]').trigger("change"),b("#gcmi-fb-regione-blocco-"+i).show())}),b(document).on("change","input[type='checkbox'][id^='fb-gcmi-prov-']",function(){var e=b(this),i=b(this).attr("id").split("-").pop(),t=b(this).parent().attr("class").split("-").pop();!1===e.prop("checked")?(b("[id='fb-gcmi-chkallpr-"+t).removeAttr("checked"),b("[name^='gcmi-com-cod-pro-"+i).find("input[type=checkbox]:checked").removeAttr("checked"),b("[name^='gcmi-com-cod-pro-"+i).hide()):(b("[name^='gcmi-com-cod-pro-"+i).show(),b("[name^='gcmi-com-cod-pro-"+i).find("input[type=checkbox]:not(:checked)").prop("checked",!0)),r(),b("[id='gcmi-fb-regione-blocco-"+t).find("input[type=checkbox][id^=fb-gcmi-prov-]:checked").length===b("[id='gcmi-fb-regione-blocco-"+t).find("input[type=checkbox][id^=fb-gcmi-prov-]").length&&b("[id='fb-gcmi-chkallpr-"+t).prop("checked",!0)}),b(document).on("change","input[type='checkbox'][id^='fb-gcmi-com-']",function(){var e=Array.from(b("label[for='"+this.name+"']").text())[0];b("[id='fb-gcmi-chkallcom-"+e).removeAttr("checked"),b("[id='gcmi-fb-lettera-blocco-"+e).find("input[type=checkbox][id^=fb-gcmi-com-]:visible:checked").length===b("[id='gcmi-fb-lettera-blocco-"+e).find("input[type=checkbox][id^=fb-gcmi-com-]:visible").length&&b("[id='fb-gcmi-chkallcom-"+e).prop("checked",!0)}),b(document).on("change","input[type='checkbox'][id^='fb-gcmi-chkallpr-']",function(){var e=b(this),i=b(this).attr("id").split("-").pop();!1===e.prop("checked")?b("#gcmi-fb-regione-blocco-"+i).find("input[type=checkbox]:checked").not("[id^='fb-gcmi-chkallpr-']").removeAttr("checked"):b("#gcmi-fb-regione-blocco-"+i).find("input[type=checkbox]:not(:checked)").not("[id^='fb-gcmi-chkallpr-']").prop("checked",!0),b("#gcmi-fb-regione-blocco-"+i).find("input[type=checkbox]").not("[id^='fb-gcmi-chkallpr-']").trigger("change")}),b(document).on("change","input[type='checkbox'][id^='fb-gcmi-chkallcom-']",function(){var e=b(this),i=b(this).attr("id").split("-").pop();!1===e.prop("checked")?b("#gcmi-fb-lettera-blocco-"+i).find("input[type=checkbox]:checked:visible").not("[id^='fb-gcmi-chkallcom-']").removeAttr("checked"):b("#gcmi-fb-lettera-blocco-"+i).find("input[type=checkbox]:not(:checked):visible").not("[id^='fb-gcmi-chkallcom-']").prop("checked",!0)}),b(document).on("change","input[type='checkbox'][id='gcmi-fb-include-ceased']",function(){c=b("#fb_gcmi_filter_name").val();var e="tmp_"+(new Date).getTime(),i=b("#gcmi-fb-include-ceased").prop("checked"),t=(event.preventDefault(),b("#gcmi-fb-tabs-4").find("input[type=checkbox]:checked").not("[id^='fb-gcmi-chkallcom-']").map(function(){return b(this).val()}).get());n(),o(),s(i,e,t,!0),h("#fb_gcmi_filter_name",function(){b("#fb_gcmi_filter_name").val(c)})})});